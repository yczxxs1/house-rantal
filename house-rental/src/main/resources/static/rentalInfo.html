<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="layui/css/layui.css" media="all">
    <link rel="stylesheet" href="css/main.css">
    <script src="layui/layui.js"></script>
    <meta charset="UTF-8">
    <title>我要发布</title>
    <style>
        .layui-upload-img{width: 92px; height: 92px; margin: 0 10px 10px 0;}

        .img-preview {
            position: relative;
        }

        .img-preview .img-remove {
            position: absolute;
            right: 0;
            width: 15px;
            font-weight: bolder;
            color: white;
            text-align: center;
            line-height: 15px;
            margin-right: 10px;
            background: #2F4056;
            opacity: .8;
        }
    </style>
</head>
<body>

<div class="layui-header header header-doc" winter>
    <div class="layui-main">
        <ul class="layui-nav">

            <li class="layui-nav-item layui-hide-xs">
                <a href="javascript:viod(0);"><img src="//t.cn/RCzsdCq" class="layui-nav-img">我的</a>
                <dl class="layui-nav-child">
                    <dd><a href="javascript:viod(0);" id="myPost">我的发布</a></dd>
                    <dd><a href="javascript:viod(0);">修改信息</a></dd>
                    <dd><a href="javascript:viod(0);" id="quitFun">退出登录</a></dd>
                </dl>
            </li>

            <li class="layui-nav-item layui-hide-xs">
                <button class="layui-btn layui-btn-radius">我要发布</button>
            </li>

        </ul>
    </div>
</div>


<div class="layui-main">

    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>我要发布</legend>
    </fieldset>
    <form class="layui-form" id="myForm">
        <div class="layui-card">
            <div class="layui-card-header">基础信息</div>
            <div class="layui-card-body">

                <div class="layui-form-item">
                    <label class="layui-form-label">小区名称:</label>
                    <div class="layui-input-block">
                        <input type="text" id="houseName" name="houseName" required lay-verify="required"
                               placeholder="请输入小区"
                               autocomplete="off"
                               class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">详细地址:</label>
                    <div class="layui-input-block">
                        <input type="text" id="houseLocation" name="houseLocation" required lay-verify="required"
                               placeholder="请输入详细地址"
                               autocomplete="off"
                               class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">房屋类型:</label>
                        <div class="layui-input-inline">
                            <input type="text" id="bedroomNum" name="bedroomNum" required lay-verify="required|number"
                                   autocomplete="off"
                                   class="layui-input">
                        </div>
                        <div class="layui-form-mid">室</div>
                        <div class="layui-input-inline">
                            <input type="text" id="livingRoomNum" name="livingRoomNum" required
                                   lay-verify="required|number" autocomplete="off"
                                   class="layui-input">
                        </div>
                        <div class="layui-form-mid">厅</div>
                        <div class="layui-input-inline">
                            <input type="text" id="bathroomNum" name="bathroomNum" required lay-verify="required|number"
                                   autocomplete="off"
                                   class="layui-input">
                        </div>
                        <div class="layui-form-mid">卫</div>
                        <div class="layui-input-inline">
                            <input type="text" id="houseArea" name="houseArea" required lay-verify="required|number"
                                   autocomplete="off"
                                   class="layui-input">
                        </div>
                        <div class="layui-form-mid">㎡</div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">楼层:</label>
                        <div class="layui-form-mid">第</div>
                        <div class="layui-input-inline">
                            <input type="text" id="houseFloor" name="houseFloor" required lay-verify="required|number"
                                   autocomplete="off"
                                   class="layui-input">
                        </div>
                        <div class="layui-form-mid">层</div>
                        <div class="layui-form-mid">共</div>
                        <div class="layui-input-inline">
                            <input type="text" id="floorNum" name="floorNum" required lay-verify="required|number"
                                   autocomplete="off"
                                   class="layui-input">
                        </div>
                        <div class="layui-form-mid">层</div>
                        <div class="layui-input-inline">
                            <select id="elevator" name="elevator" lay-verify="required">
                                <option value="无电梯">无电梯</option>
                                <option value="有电梯">有电梯</option>
                            </select>
                        </div>

                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">租金:</label>
                        <div class="layui-input-inline">
                            <input type="text" id="houseRent" name="houseRent" required lay-verify="required|number"
                                   autocomplete="off"
                                   class="layui-input">
                        </div>
                        <div class="layui-form-mid">元/月</div>
                        <div class="layui-input-inline">
                            <select id="paymentMethod" name="paymentMethod" lay-verify="required">
                                <option value="押一付一">押一付一</option>
                                <option value="押一付三">押一付三</option>
                                <option value="半年付">半年付</option>
                                <option value="年付">年付</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">车位:</label>
                    <div class="layui-input-inline">
                        <select id="parkingSpace" name="parkingSpace" lay-verify="required">
                            <option value="无">无</option>
                            <option value="有">有</option>
                        </select>
                    </div>
                </div>

                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">房源描述:</label>
                    <div class="layui-input-block">
                        <textarea id="houseDesc" name="houseDesc" placeholder="周围交通及生活配套..."
                                  class="layui-textarea"></textarea>
                    </div>
                </div>

                  <div class="layui-form-item">
                      <label class="layui-form-label">上传图片:</label>
                      <input type="hidden" id="houseImgs" name="houseImgs">
                      <div class="layui-input-block">
                          <div class="layui-upload">
                              <button type="button" class="layui-btn layui-btn-primary layui-btn-radius" id="test2">图片上传</button>
                              <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
                                  预览图：
                                  <div class="layui-upload-list" id="demo2"></div>
                              </blockquote>
                          </div>
                      </div>
                  </div>


            </div>
        </div>


        <div class="layui-card">
            <div class="layui-card-header">其他信息</div>
            <div class="layui-card-body">

                <div class="layui-form-item">
                    <label class="layui-form-label">联系人:</label>
                    <div class="layui-input-inline">
                        <input type="text" id="houseContactName" name="houseContactName" lay-verify="title"
                               autocomplete="off"
                               class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">联系人身份:</label>
                    <div class="layui-input-inline">
                        <select id="houseContactIdentity" name="houseContactIdentity" lay-verify="required">
                            <option value="个人房东">个人房东</option>
                            <option value="个人转租">个人转租</option>
                            <option value="职业房东">职业房东</option>
                        </select>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">联系人手机:</label>
                    <div class="layui-input-inline">
                        <input type="tel" id="houseContactPhone" name="houseContactPhone" lay-verify="required|phone"
                               autocomplete="off"
                               class="layui-input">
                    </div>
                </div>


                <div id="createRental" class="layui-form-item" style="float: right">
                    <div class="layui-input-block">
                        <button type="button" class="layui-btn" lay-submit lay-filter="rentalCreate">立即提交</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>


                <div id="editRental" class="layui-form-item" style="float: right;display: none">
                    <div class="layui-input-block">
                        <input type="hidden" id="editRentalId">
                        <button type="button" class="layui-btn" lay-submit lay-filter="rentalEdit">立即更新</button>
                        <button id="backMyList" type="button" class="layui-btn layui-btn-primary">返回</button>
                    </div>
                </div>

            </div>
        </div>

    </form>

</div>
</body>
<script src="login/vendor/jquery/jquery-3.2.1.min.js"></script>
<script src="login/vendor/jquery/jquery.cookie.js"></script>
<script src="login/vendor/jquery/jquery.form.min.js"></script>
<script src="js/main.js"></script>
<script>



    window.onload = function () {

        if ($.cookie('user_id') == null) {
            $(location).attr('href', 'login.html');
            layer.msg("请先登录!");
        }

        var rentalId = getUrlParam().editRentalId;

        if (rentalId !== undefined && rentalId !== null && rentalId !== "") {
            $("#createRental").hide();
            $("#editRental").show();
            $("#editRentalId").attr("value", rentalId);
            //填充页面
            $.ajax({
                url: "/rentalInfo/" + rentalId,
                type: "GET",
                dataType: "json",
                success: function (data) {


                    $("#bedroomNum").val(data.data.bedroomNum);
                    $("#bathroomNum").val(data.data.bathroomNum);
                    $("#elevator").val(data.data.elevator);
                    $("#floorNum").val(data.data.floorNum);
                    $("#houseArea").val(data.data.houseArea);
                    $("#houseContactIdentity").val(data.data.houseContactIdentity);
                    $("#houseContactName").val(data.data.houseContactName);
                    $("#houseContactPhone").val(data.data.houseContactPhone);
                    $("#houseDesc").val(data.data.houseDesc);
                    $("#houseFloor").val(data.data.houseFloor);
                    $("#houseName").val(data.data.houseName);
                    $("#houseRent").val(data.data.houseRent);
                    $("#livingRoomNum").val(data.data.livingRoomNum);
                    $("#parkingSpace").val(data.data.parkingSpace);
                    $("#paymentMethod").val(data.data.paymentMethod);
                    $("#houseLocation").val(data.data.houseLocation);


                    var x=data.data.houseImgs.split(";");
                    for (var i = 0; i < x.length; i++) {
                        var imgElement = $(['<span class="img-preview">'
                            , '<img name="houseImg" src="' + imgPreview+x[i] + '" alt="' + x[i]  + '" class="layui-upload-img">'
                            , '<i class="layui-icon layui-icon-delete img-remove" onclick="removeImg(this)"></i>'
                            , '</span>'].join(''));
                        $('#demo2').append(imgElement);

                    }


                    renderForm();

                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {

                    layer.alert('请检查链接是否正确!', {closeBtn: 0}, function (index) {
                        $(location).attr('href', 'list.html?userId=' + $.cookie('user_id'));
                        layer.close(index);
                    });
                }
            })

        } else {

            $("#createRental").show();
            $("#editRental").hide();
        }
    };

    function removeImg(a) {
        a.parentElement.remove();
    }
</script>
</html>